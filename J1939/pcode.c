
/*
 * @File name - pcode.c
 * @Author    - Enkhbat Batbayar
 * @Date      - 2020 Nov 12
 * 
 *
 *
 */

#include "pcode.h"

uint8_t failure_indicator;

// The array includes PGN number of P Code, some of the P Code is not available in YAMAHA & J1939 document from Kukje company.
// Thus, if the PGN is not availabe it will be illustrated 0xFFFF (65535).
const uint16_t pcode_pgn[NUMBER_OF_PCODE] = { 
  65535, 65535, 65535, 65535, 65535, 61443, 61443, 61443, 61443, 65266, 65266, 65270, 65270,  //   0 - 12
  65270, 65270, 65535, 65535, 65535, 65262, 65262, 65262, 65262, 65296, 65296, 65296, 65262,  //  13 - 25
  65262, 65262, 65243, 65243, 64946, 64946, 65535, 65535, 64948, 64948, 64946, 64946, 65269,  //  26 - 38
  65269, 65269, 65188, 65188, 65188, 65270, 65270, 65270, 65270, 65270, 65270, 65535, 65535,  //  39 - 51
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  //  52 - 64
  61466, 61466, 61466, 65535, 65535, 65535, 65243, 65243, 61444, 65535, 65535, 65535, 65535,  //  65 - 77
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65260, 65260, 65535, 65535, 65535, 65535,  //  78 - 90
  56576, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65259, 65259, 65535,  //  91 - 103
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 104 - 116
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65271, 65271, 65535, 65535,  // 117 - 129
  64946, 65535, 65535, 65535, 65535, 64891, 64891, 64891, 64891, 64948, 64946, 64946, 64946,  // 130 - 142
  64891, 64891, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 143 - 155
  64830, 64830, 64830, 64830, 64830, 64830, 61475, 61475, 61475, 61475, 65535, 64923, 64923,  // 156 - 168
  64923, 64923, 64923, 64923, 64923, 65110, 65110, 65110, 65110, 65110, 65110, 65110, 65110,  // 169 - 181
  65110, 65110, 65110, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 182 - 194
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 195 - 207
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 208 - 220
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 221 - 233
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65269, 65535,  // 234 - 246
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 247 - 259
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535,  // 260 - 272
  65535, 65535, 65535, 65535, 65535, 65535, 65535, 65535, 65110, 65110, 64923, 64923, 64923   // 273 - 286
};
const uint8_t pcode_failure_led[NUMBER_OF_PCODE] = {
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    APP_S,       FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_AWL,
  FAIL_AWL,    APP_S,       FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,
  FAIL_AWL,    FAIL_RSL,    NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, FAIL_RSL,    FAIL_AWL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    APP_S,       APP_S,       FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    APP_S,
  FAIL_AWL,    NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, NO_COMES_ON, FAIL_RSL,    FAIL_AWL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_RSL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,
  FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    NO_COMES_ON, NO_COMES_ON,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_RSL,
  FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_AWL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL,    FAIL_RSL
};

const uint8_t pcode_fmi[NUMBER_OF_PCODE] = { 
   2,  5,  2,  5,  5,  3,  4,  3,  4,  3,  4,  3,  4,  //   0 - 12
  13, 10,  3,  4, 13,  3,  4,  0, 10,  3,  4, 10,  3,  //  13 - 25
   4,  0,  3,  4,  3,  4,  3,  4,  3,  4,  3,  4,  3,  //  26 - 38
   4, 10,  3,  4, 10,  3,  4, 10,  3,  4, 10,  2,  5,  //  39 - 51
   6,  5,  5,  5,  5,  3,  6,  5,  3,  6,  5,  4,  3,  //  52 - 64
   3,  5,  7,  0, 15, 13,  0, 18,  0, 12, 13, 12,  5,  //  65 - 77
   3,  7,  8,  9,  9,  9,  9, 31, 13,  9,  9,  9, 12,  //  78 - 90
   2,  9,255,255,255,255,255,255,255,255,  2,  2,  9,  //  91 - 103
  12, 12, 12,  7,  7,  7,  9, 12,  0,  1,  1,  1,  2,  // 104 - 116
   1,  0,  1,  0, 12, 12, 12,  0,  0,  5,  1,  4,  1,  // 117 - 129
   1,  0,  0, 11,  7,  9, 16,  0, 16,  0,  0, 13,  0,  // 130 - 142
   0,  7,  0,  7,  3,  5, 15, 17,  0,  7,  3,  5, 10,  // 143 - 155
   3,  4,  0, 15, 17, 10,  3,  4, 15, 17, 12,  2,  3,  // 156 - 168
   4, 13,  3,  4, 13,  2,  3,  4, 13,  3,  4, 13, 15,  // 169 - 181
   0, 15, 17,  2,  0,  3,  4,  5,  0,  3,  5,  3,  4,  // 182 - 194
   0,  7,  3,  4,  5,  0, 10,  7,  7,  8,  8,  2,  2,  // 195 - 207
   1, 10,  3,  4,  5,  0,  3,  4,  3,  5,  0, 10,  2,  // 208 - 220
   2,  1, 10,  3,  4,  3,  4,  3,  3,  5,  0,  3,  5,  // 221 - 233
   0,  3,  5,  0,  3,  4,  5,  0,  9,  9,  9, 19,  0,  // 234 - 246
   9,  9,  3,  3,  4,  4,  2, 12, 12, 12, 12, 12,  3,  // 247 - 259
   4, 12, 12,  3,  4,  7,  5,  0,  7,  0,  0,  7,  7,  // 260 - 272
   2,  1, 10,  0,  1,  7, 16,  0, 18,  1,  1,  0, 13   // 273 - 286
};

// 13 x 22 matrix
const char pcode[NUMBER_OF_PCODE][PCODE_LENGTH] = { 
  "P0336", "P0337", "P0341", "P0342", "P0008", "P0123", "P0122", "P0228", "P0227", "P02E9", "P02E8", "P0238", "P0237",  //   0 - 12
  "P0236", "P1673", "P0473", "P0472", "P0471", "P0118", "P0117", "P0217", "P1674", "P0113", "P0112", "P1678", "P0183",  //  13 - 25
  "P0182", "P0168", "P0193", "P0192", "P2455", "P2454", "P1455", "P1454", "P1428", "P1427", "P1434", "P1435", "P2229",  //  26 - 38
  "P2228", "P1231", "P041D", "P041C", "P1675", "P040D", "P040C", "P1676", "P0546", "P0545", "P1677", "P068A", "P0543",  //  39 - 51
  "P0541", "P0201", "P0202", "P0203", "P0204", "P2148", "P2147", "P2146", "P2151", "P2150", "P2149", "P0611", "P0200",  //  52 - 64
  "P0629", "P0627", "P2635", "P1235", "P1236", "P1237", "P0088", "P0094", "P0219", "P1631", "P1632", "P1630", "P0660",  //  65 - 77
  "P1658", "P1655", "P1656", "U0292", "U1301", "U1292", "U1293", "U0168", "U3002", "U1303", "U1302", "U010B", "U0167",  //  78 - 90
  "U0426", "U1501", "U1503", "U1504", "U1505", "U1506", "U1507", "U1508", "U1509", "U1510", "P1672", "P264F", "U1502",  //  91 - 103
  "P0403", "P1405", "P0488", "P1409", "P148A", "P049D", "U0401", "U1401", "P0404", "P1404", "P1410", "P1411", "P1601",  // 104 - 116
  "P0652", "P0653", "P0698", "P0699", "P0607", "P0606", "P1602", "P1101", "P1151", "P1562", "P1568", "P1192", "P1198",  // 117 - 129
  "P0420", "P2463", "P1463", "P2459", "P2458", "P1445", "P242F", "P1420", "P1421", "P1436", "P2452", "P2453", "P1426",  // 130 - 142
  "P1424", "P1446", "P1545", "P2209", "P2203", "P151C", "P1525", "P1526", "P1546", "P2222", "P2216", "P151D", "P1524",  // 143 - 155
  "P0428", "P0427", "P0426", "P153B", "P1541", "P1542", "P204D", "P204C", "P153C", "P153D", "P1516", "P1559", "P206D",  // 156 - 168
  "P206C", "P154F", "P1551", "P1552", "P1550", "P1557", "P203D", "P203C", "P155A", "P205D", "P205C", "P1556", "P155B",  // 169 - 181
  "P205B", "P1539", "P153A", "P154B", "P1504", "P21C4", "P21C3", "P21C2", "P1509", "P2049", "P2047", "P151B", "P2048",  // 182 - 194
  "P1505", "P208E", "P208D", "P208C", "P208A", "P150D", "P151F", "P208B", "P20AD", "P152F", "P152E", "P1530", "P1531",  // 195 - 207
  "P152B", "P1544", "P20A3", "P20A2", "P20A0", "P150E", "P26E9", "P26E8", "P20C8", "P20C5", "P150B", "P20B6", "P152C",  // 208 - 220
  "P152D", "P152A", "P1543", "P2671", "P2670", "P2686", "P2685", "P1510", "P20BC", "P20B9", "P1507", "P20C0", "P20BD",  // 221 - 233
  "P1508", "P20C4", "P20C1", "P150A", "P202C", "P202B", "P202A", "P150C", "U029D", "U029E", "U1607", "P1555", "P155C",  // 234 - 246
  "U1610", "U1611", "P1512", "P1514", "P1511", "P1513", "P20EA", "P1600", "P160E", "P160F", "P1500", "P1501", "P21CC",  // 247 - 259
  "P21CB", "P1502", "P1503", "P1517", "P1519", "P20EB", "P1561", "P1533", "P1534", "P20E9", "P1536", "P1532", "P1535",  // 260 - 272
  "P150F", "P1537", "P1538", "P204F", "P1520", "P1506", "P1553", "P1554", "P1549", "P154A", "P154E", "P154D", "P1558"   // 273 - 286
};

// 13 x 22 matrix
const char pcode_spn_in_string[NUMBER_OF_PCODE][SPN_LENGTH] = {
  "522400", "522400", "522401", "522401", "523249", "000091", "000091", "000029", "000029", "000051", "000051", "000102", "000102",  //   0 - 12
  "000102", "000102", "001209", "001209", "001209", "000110", "000110", "000110", "000110", "000172", "000172", "000172", "000174",  //  13 - 25
  "000174", "000174", "000157", "000157", "003251", "003251", "003609", "003609", "003242", "003242", "003250", "003250", "000108",  //  26 - 38
  "000108", "000108", "000412", "000412", "000412", "000105", "000105", "000105", "000173", "000173", "000173", "001485", "522243",  //  39 - 51
  "522243", "000651", "000652", "000653", "000654", "002797", "002797", "002797", "002798", "002798", "002798", "522996", "522997",  //  52 - 64
  "000633", "000633", "000633", "001347", "001347", "522803", "000157", "000157", "000190", "523221", "523221", "522995", "002950",  //  65 - 77
  "002950", "002950", "002950", "522596", "522597", "522599", "522600", "000237", "000237", "522619", "522618", "522610", "522730",  //  78 - 90
  "001202", "523513", "------", "------", "------", "------", "------", "------", "------", "------", "000587", "000588", "523643",  //  91 - 103
  "002791", "522579", "522580", "002791", "522581", "522582", "002791", "522617", "002791", "002791", "522583", "522584", "000630",  // 104 - 116
  "523074", "523074", "523075", "523075", "522993", "522994", "522998", "522323", "522329", "000167", "000167", "000100", "000100",  // 117 - 129
  "003250", "522573", "522574", "522577", "522575", "003719", "003720", "003720", "003719", "003242", "003251", "003251", "003250",  // 130 - 142
  "003719", "003719", "523595", "523597", "523595", "523595", "003216", "003216", "523596", "523598", "523596", "523596", "523606",  // 143 - 155
  "004360", "004360", "004360", "004360", "004360", "004360", "004334", "004334", "004334", "004334", "523576", "003515", "003516",  // 156 - 168
  "003516", "003516", "003515", "003515", "003515", "003031", "001761", "001761", "001761", "003031", "003031", "003031", "001761",  // 169 - 181
  "003031", "003031", "003031", "523630", "523581", "523592", "523592", "523592", "523592", "523586", "523586", "523585", "523586",  // 182 - 194
  "523584", "523588", "004375", "004375", "004375", "004375", "004375", "004375", "523618", "523614", "523615", "523616", "523617",  // 195 - 207
  "523611", "523611", "523600", "523600", "523600", "523599", "523556", "523556", "523593", "523556", "523610", "523556", "523612",  // 208 - 220
  "523613", "523610", "523610", "523554", "523554", "523555", "523555", "523557", "004343", "004343", "004343", "004341", "004341",  // 221 - 233
  "004341", "004345", "004345", "004345", "523594", "005137", "005137", "005137", "523562", "523563", "523570", "000172", "523637",  // 234 - 246
  "523634", "523635", "523558", "523559", "523559", "523558", "523560", "523589", "523590", "523591", "523577", "523578", "523574",  // 247 - 259
  "523574", "523579", "523580", "523582", "523582", "523560", "523640", "523621", "523622", "523619", "523626", "523620", "523624",  // 260 - 272
  "523623", "523627", "523628", "523625", "523601", "523557", "523636", "523636", "001761", "001761", "003516", "003516", "003521",  // 273 - 286
};

// 13 x 22 matrix
const uint32_t pcode_spn[NUMBER_OF_PCODE] = {
  522400, 522400, 522401, 522401, 523249,     91,     91,     29,     29,     51,     51,    102,    102,  //   0 - 12
     102,    102,   1209,   1209,   1209,    110,    110,    110,    110,    172,    172,    172,    174,  //  13 - 25
     174,    174,    157,    157,   3251,   3251,   3609,   3609,   3242,   3242,   3250,   3250,    108,  //  26 - 38
     108,    108,    412,    412,    412,    105,    105,    105,    173,    173,    173,   1485, 522243,  //  39 - 51
  522243,    651,    652,    653,    654,   2797,   2797,   2797,   2798,   2798,   2798, 522996, 522997,  //  52 - 64
     633,    633,    633,   1347,   1347, 522803,    157,    157,    190, 523221, 523221, 522995,   2950,  //  65 - 77
    2950,   2950,   2950, 522596, 522597, 522599, 522600,    237,    237, 522619, 522618, 522610, 522730,  //  78 - 90
    1202, 523513,      0,      0,      0,      0,      0,      0,      0,      0,    587,    588, 523643,  //  91 - 103
    2791, 522579, 522580,   2791, 522581, 522582,   2791, 522617,   2791,   2791, 522583, 522584,    630,  // 104 - 116
  523074, 523074, 523075, 523075, 522993, 522994, 522998, 522323, 522329,    167,    167,    100,    100,  // 117 - 129
    3250, 522573, 522574, 522577, 522575,   3719,   3720,   3720,   3719,   3242,   3251,   3251,   3250,  // 130 - 142
    3719,   3719, 523595, 523597, 523595, 523595,   3216,   3216, 523596, 523598, 523596, 523596, 523606,  // 143 - 155
    4360,   4360,   4360,   4360,   4360,   4360,   4334,   4334,   4334,   4334, 523576,   3515,   3516,  // 156 - 168
    3516,   3516,   3515,   3515,   3515,   3031,   1761,   1761,   1761,   3031,   3031,   3031,   1761,  // 169 - 181
    3031,   3031,   3031, 523630, 523581, 523592, 523592, 523592, 523592, 523586, 523586, 523585, 523586,  // 182 - 194
  523584, 523588,   4375,   4375,   4375,   4375,   4375,   4375, 523618, 523614, 523615, 523616, 523617,  // 195 - 207
  523611, 523611, 523600, 523600, 523600, 523599, 523556, 523556, 523593, 523556, 523610, 523556, 523612,  // 208 - 220
  523613, 523610, 523610, 523554, 523554, 523555, 523555, 523557,   4343,   4343,   4343,   4341,   4341,  // 221 - 233
    4341,   4345,   4345,   4345, 523594,   5137,   5137,   5137, 523562, 523563, 523570,    172, 523637,  // 234 - 246
  523634, 523635, 523558, 523559, 523559, 523558, 523560, 523589, 523590, 523591, 523577, 523578, 523574,  // 247 - 259
  523574, 523579, 523580, 523582, 523582, 523560, 523640, 523621, 523622, 523619, 523626, 523620, 523624,  // 260 - 272
  523623, 523627, 523628, 523625, 523601, 523557, 523636, 523636,   1761,   1761,   3516,   3516,   3521,  // 273 - 286
};